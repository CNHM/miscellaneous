local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")

local SynthUI = {}
SynthUI.__index = SynthUI

local function createInstance(className, parent, props)
    local instance = Instance.new(className)
    instance.Parent = parent or nil
    
    if props then
        for key, value in pairs(props) do
            if key == "Size" or key == "Position" then
                instance[key] = UDim2.new(value.X.Scale or 0, value.X.Offset or 0, value.Y.Scale or 0, value.Y.Offset or 0)
            elseif key == "AnchorPoint" then
                instance[key] = Vector2.new(value.X or 0, value.Y or 0)
            elseif key == "BackgroundColor3" then
                instance[key] = Color3.fromRGB(value.R or 255, value.G or 255, value.B or 255)
            elseif key == "TextColor3" then
                instance[key] = Color3.fromRGB(value.R or 255, value.G or 255, value.B or 255)
            elseif key == "Font" then
                -- ç¡®ä¿ Enum.Font[value] å­˜åœ¨
                instance[key] = Enum.Font[value] or Enum.Font.Gotham
            elseif key == "TextSize" then
                instance[key] = value
            elseif key == "Transparency" then
                instance[key] = value
            else
                instance[key] = value
            end
        end
    end
    
    -- ä¸º Frame, Button, TextBox ç­‰æ·»åŠ  UICorner
    if className == "Frame" or className == "TextButton" or className == "ImageButton" or className == "TextBox" then
        local corner = Instance.new("UICorner")
        -- ä½¿ç”¨ props.CornerRadiusï¼Œå¦‚æœæ²¡æœ‰åˆ™é»˜è®¤ä¸º 4
        corner.CornerRadius = UDim.new(0, props and props.CornerRadius or 4) 
        corner.Parent = instance
    end
    
    return instance
end

local function tween(instance, goal, duration, easingStyle)
    local tweenInfo = TweenInfo.new(duration or 0.2, easingStyle or Enum.EasingStyle.Quad, Enum.EasingDirection.InOut)
    local tween = TweenService:Create(instance, tweenInfo, goal)
    tween:Play()
    return tween
end

function SynthUI.MakeDraggable(frame, dragHandle)
    dragHandle = dragHandle or frame
    local dragging = false
    local dragStart = nil
    local startPos = nil
    
    local function updateInput(input)
        local delta = input.Position - dragStart
        local newPos = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        -- ç§»é™¤è¾¹ç•Œé™åˆ¶ä»¥ç®€åŒ–æ‹–åŠ¨ï¼Œä½†åœ¨å®é™…é¡¹ç›®ä¸­å¯èƒ½éœ€è¦
        -- local screenSize = workspace.CurrentCamera.ViewportSize
        -- local frameSize = frame.AbsoluteSize
        -- newPos = UDim2.new(math.clamp(newPos.X.Scale, 0, 1 - frameSize.X / screenSize.X), newPos.X.Offset, 
        --                    math.clamp(newPos.Y.Scale, 0, 1 - frameSize.Y / screenSize.Y), newPos.Y.Offset)
        tween(frame, {Position = newPos}, 0.05) -- è°ƒä½æŒç»­æ—¶é—´ä»¥å®ç°æ›´æµç•…çš„æ‹–åŠ¨
    end
    
    dragHandle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            tween(frame, {Size = frame.Size * 0.99}, 0.1) -- è½»å¾®ç¼©å°è§†è§‰æ•ˆæœ
        end
    end)
    
    dragHandle.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
            tween(frame, {Size = frame.Size / 0.99}, 0.1) -- æ¢å¤å¤§å°
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            updateInput(input)
        end
    end)
end

function SynthUI.createScreenGui(parent, props)
    local gui = createInstance("ScreenGui", parent, props)
    gui.IgnoreGuiInset = props.IgnoreGuiInset or true -- æ¨èå¼€å¯ä»¥é¿å…é¡¶éƒ¨åç§»
    return gui
end

function SynthUI.Frame(props, parent)
    local frame = createInstance("Frame", parent, props)
    frame.BorderSizePixel = props.BorderSizePixel or 0
    frame.BackgroundColor3 = props.BackgroundColor3 or Color3.fromRGB(255, 255, 255)
    frame.BackgroundTransparency = props.BackgroundTransparency or 0
    return frame
end

function SynthUI.Label(props, parent)
    local label = createInstance("TextLabel", parent, props)
    label.Text = props.Text or ""
    -- ä¿®æ­£: é»˜è®¤ä¸ä½¿ç”¨ TextScaledï¼Œä½¿ç”¨ TextSize æ›´ç²¾ç¡®æ§åˆ¶
    label.TextScaled = props.TextScaled or false 
    label.TextSize = props.TextSize or 14
    label.BackgroundTransparency = props.BackgroundTransparency or 1
    label.TextColor3 = props.TextColor3 or Color3.fromRGB(0, 0, 0)
    label.TextXAlignment = props.TextXAlignment or Enum.TextXAlignment.Center
    label.TextYAlignment = props.TextYAlignment or Enum.TextYAlignment.Center
    return label
end

function SynthUI.Button(props, parent)
    local button = createInstance("TextButton", parent, props)
    button.Text = props.Text or "Button"
    button.TextScaled = props.TextScaled or false
    button.TextSize = props.TextSize or 14
    button.BackgroundColor3 = props.BackgroundColor3 or Color3.fromRGB(85, 170, 255)
    button.TextColor3 = props.TextColor3 or Color3.fromRGB(255, 255, 255)
    
    local originalSize = button.Size
    local originalColor = button.BackgroundColor3
    
    button.MouseEnter:Connect(function()
        tween(button, {Size = originalSize * 1.02}, 0.2)
    end)
    button.MouseLeave:Connect(function()
        tween(button, {Size = originalSize}, 0.2)
    end)
    
    button.MouseButton1Click:Connect(function()
        spawn(function()
            tween(button, {BackgroundColor3 = originalColor:Lerp(Color3.new(0,0,0), 0.2)}, 0.1)
            wait(0.1)
            tween(button, {BackgroundColor3 = originalColor}, 0.1)
        end)
        if props.Callback then props.Callback() end
    end)
    
    return button
end

function SynthUI.TextBox(props, parent)
    local textbox = createInstance("TextBox", parent, props)
    textbox.Text = props.Text or ""
    textbox.TextScaled = props.TextScaled or false
    textbox.TextSize = props.TextSize or 14
    textbox.PlaceholderText = props.PlaceholderText or "Enter text..."
    textbox.BackgroundColor3 = props.BackgroundColor3 or Color3.fromRGB(255, 255, 255)
    
    local originalColor = textbox.BackgroundColor3
    
    textbox.Focused:Connect(function()
        tween(textbox, {BackgroundColor3 = originalColor:Lerp(Color3.fromRGB(0,0,0), 0.05)}, 0.2)
    end)
    textbox.FocusLost:Connect(function()
        tween(textbox, {BackgroundColor3 = originalColor}, 0.2)
        if props.FocusLost then props.FocusLost(textbox.Text) end
    end)
    
    return textbox
end

function SynthUI.ImageLabel(props, parent)
    local image = createInstance("ImageLabel", parent, props)
    image.Image = props.Image or ""
    image.ScaleType = Enum.ScaleType.Fit
    -- ç§»é™¤é‡å¤çš„ UICorner é€»è¾‘ï¼Œå› ä¸ºå®ƒå·²åœ¨ createInstance ä¸­å¤„ç†
    return image
end

function SynthUI.ImageButton(props, parent)
    local button = createInstance("ImageButton", parent, props)
    button.Image = props.Image or ""
    button.ScaleType = Enum.ScaleType.Fit
    
    local originalSize = button.Size
    
    button.MouseEnter:Connect(function()
        tween(button, {Size = originalSize * 1.05}, 0.2)
    end)
    button.MouseLeave:Connect(function()
        tween(button, {Size = originalSize}, 0.2)
    end)
    
    button.MouseButton1Click:Connect(function()
        if props.Callback then props.Callback() end
    end)
    
    return button
end

function SynthUI.ScrollingFrame(props, parent)
    local scroll = createInstance("ScrollingFrame", parent, props)
    scroll.ScrollBarThickness = props.ScrollBarThickness or 10
    scroll.CanvasSize = props.CanvasSize or UDim2.new(0, 0, 0, 0)
    return scroll
end

function SynthUI.Slider(props, parent)
    local container = SynthUI.Frame({Size = props.Size or UDim2.new(1, 0, 0, 20), BackgroundColor3 = Color3.fromRGB(200, 200, 200), CornerRadius = 10}, parent)
    local bar = SynthUI.Frame({Size = UDim2.new(props.Value or 0.5, 0, 1, 0), BackgroundColor3 = Color3.fromRGB(85, 170, 255), AnchorPoint = Vector2.new(0, 0.5)}, container)
    bar.Position = UDim2.new(bar.Size.X.Scale, 0, 0.5, 0) -- åˆå§‹ä½ç½®åŸºäºåˆå§‹å€¼
    
    local handle = SynthUI.Frame({Size = UDim2.new(0, 10, 0, 20), BackgroundColor3 = Color3.fromRGB(255, 255, 255), AnchorPoint = Vector2.new(0.5, 0.5), CornerRadius = 10}, bar)
    handle.Position = UDim2.new(1, 0, 0.5, 0)
    
    local dragging = false
    local minVal = props.Min or 0
    local maxVal = props.Max or 1
    local step = props.Step or 0
    
    local function updateValue(relX)
        local rawValue = relX * (maxVal - minVal) + minVal
        
        if step > 0 then
            rawValue = math.floor(rawValue / step) * step
        end
        
        local value = math.clamp(rawValue, minVal, maxVal)
        local valueRatio = (value - minVal) / (maxVal - minVal)
        
        tween(bar, {Size = UDim2.new(valueRatio, 0, 1, 0)}, 0.1)
        
        if props.ValueChanged then 
             props.ValueChanged(value) 
        end
    end
    
    local function onInputBegan(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
        end
    end
    
    local function onInputEnded(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end
    
    local function onInputChanged(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local mousePos = input.Position or Players.LocalPlayer:GetMouse().Position
            local relX = math.clamp((mousePos.X - container.AbsolutePosition.X) / container.AbsoluteSize.X, 0, 1)
            updateValue(relX)
        end
    end
    
    -- ç»‘å®šæ‹–åŠ¨äº‹ä»¶åˆ°å®¹å™¨
    container.InputBegan:Connect(onInputBegan)
    container.InputEnded:Connect(onInputEnded)
    UserInputService.InputChanged:Connect(onInputChanged)
    
    -- å…è®¸ç›´æ¥ç‚¹å‡»å®¹å™¨æ¥è®¾ç½®å€¼
    container.MouseButton1Down:Connect(function(x, y)
        local mouse = Players.LocalPlayer:GetMouse()
        local relX = math.clamp((mouse.X - container.AbsolutePosition.X) / container.AbsoluteSize.X, 0, 1)
        updateValue(relX)
    end)
    
    -- åˆå§‹æ›´æ–°
    updateValue(props.Value or 0.5)
    
    return container
end

function SynthUI.Checkbox(props, parent)
    local container = SynthUI.Frame({Size = UDim2.new(0, 20, 0, 20), BackgroundColor3 = Color3.fromRGB(255, 255, 255), CornerRadius = 4}, parent)
    local check = SynthUI.Frame({Size = UDim2.new(0, 12, 0, 12), BackgroundColor3 = Color3.fromRGB(85, 170, 255), Visible = props.Checked or false, CornerRadius = 2}, container)
    check.Position = UDim2.new(0.5, 0, 0.5, 0)
    check.AnchorPoint = Vector2.new(0.5, 0.5)
    
    local label = SynthUI.Label({Text = props.Text or "", Size = UDim2.new(1, -20, 1, 0), Position = UDim2.new(0, 25, 0, 0), BackgroundTransparency = 1, TextXAlignment = Enum.TextXAlignment.Left, TextColor3 = Color3.fromRGB(0, 0, 0)}, parent)
    
    container.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            check.Visible = not check.Visible
            tween(container, {BackgroundColor3 = check.Visible and Color3.fromRGB(240, 250, 255) or Color3.fromRGB(255, 255, 255)}, 0.2)
            if props.Callback then props.Callback(check.Visible) end
        end
    end)
    
    return container
end

function SynthUI.Dropdown(props, parent)
    local container = SynthUI.Frame({Size = props.Size or UDim2.new(0, 100, 0, 30), BackgroundColor3 = Color3.fromRGB(255, 255, 255)}, parent)
    local button = SynthUI.Button({Text = props.Items[1] or "Select", Size = UDim2.new(1, 0, 1, 0), Parent = container, BackgroundColor3 = Color3.fromRGB(255, 255, 255), TextColor3 = Color3.fromRGB(0, 0, 0)}, container)
    
    local defaultHeight = (#props.Items > 5 and 5 * 30) or (#props.Items * 30) -- é™åˆ¶æœ€å¤§é«˜åº¦
    local menu = SynthUI.ScrollingFrame({
        Size = UDim2.new(1, 0, 0, 0), 
        Position = UDim2.new(0, 0, 1, 0), 
        CanvasSize = UDim2.new(0, 0, 0, #props.Items * 30), 
        BackgroundColor3 = Color3.fromRGB(240, 240, 240), 
        Visible = false,
        ZIndex = 2 -- ç¡®ä¿èœå•åœ¨é¡¶éƒ¨
    }, container)
    menu.ClipsDescendants = true
    
    local itemIndex = 1
    for i, item in ipairs(props.Items) do
        local itemBtn = SynthUI.Button({
            Text = item, 
            Size = UDim2.new(1, 0, 0, 30), 
            Position = UDim2.new(0, 0, 0, (i-1)*30), 
            BackgroundColor3 = Color3.fromRGB(240, 240, 240),
            TextColor3 = Color3.fromRGB(0, 0, 0),
            Parent = menu
        }, menu)
        itemBtn.ZIndex = 3
        
        itemBtn.MouseButton1Click:Connect(function()
            button.Text = item
            itemIndex = i
            tween(menu, {Size = UDim2.new(1, 0, 0, 0)}, 0.2)
            wait(0.2)
            menu.Visible = false
            if props.Callback then props.Callback(item, i) end
        end)
    end
    
    button.MouseButton1Click:Connect(function()
        local isOpening = not menu.Visible
        menu.Visible = true
        if isOpening then
            tween(menu, {Size = UDim2.new(1, 0, 0, defaultHeight)}, 0.2)
        else
            tween(menu, {Size = UDim2.new(1, 0, 0, 0)}, 0.2)
            wait(0.2)
            menu.Visible = false
        end
    end)
    
    return container
end

function SynthUI.ProgressBar(props, parent)
    local container = SynthUI.Frame({Size = props.Size or UDim2.new(1, 0, 0, 20), BackgroundColor3 = Color3.fromRGB(200, 200, 200), CornerRadius = 10}, parent)
    local bar = SynthUI.Frame({Size = UDim2.new(props.Value or 0, 0, 1, 0), BackgroundColor3 = Color3.fromRGB(85, 170, 255), CornerRadius = 10}, container)
    
    local function update()
        local value = math.clamp(props.Value or 0, 0, 1)
        tween(bar, {Size = UDim2.new(value, 0, 1, 0)}, 0.3)
    end
    update()
    
    -- æ³¨æ„ï¼šLua åº“ä¸­ props.OnUpdate æ— æ³•ç›´æ¥ç»‘å®š Roblox Eventã€‚å¦‚æœéœ€è¦åŠ¨æ€æ›´æ–°ï¼Œ
    -- éœ€è¦å¤–éƒ¨ä»£ç ç›´æ¥ä¿®æ”¹ props.Value å¹¶è°ƒç”¨ update å‡½æ•°ã€‚
    
    return container
end

function SynthUI.ToggleSwitch(props, parent)
    local container = SynthUI.Frame({Size = UDim2.new(0, 50, 0, 25), BackgroundColor3 = Color3.fromRGB(200, 200, 200), CornerRadius = 12}, parent)
    local knob = SynthUI.Frame({Size = UDim2.new(0, 20, 0, 20), Position = UDim2.new(0, 2, 0.5, -10), BackgroundColor3 = Color3.fromRGB(255, 255, 255), AnchorPoint = Vector2.new(0, 0.5), CornerRadius = 10}, container)
    
    local isOn = props.Default or false
    local function updateState()
        if isOn then
            tween(container, {BackgroundColor3 = Color3.fromRGB(85, 170, 255)}, 0.2)
            tween(knob, {Position = UDim2.new(1, -22, 0.5, 0)}, 0.2) -- è°ƒæ•´ Position
        else
            tween(container, {BackgroundColor3 = Color3.fromRGB(200, 200, 200)}, 0.2)
            tween(knob, {Position = UDim2.new(0, 2, 0.5, 0)}, 0.2) -- è°ƒæ•´ Position
        end
        if props.Callback then props.Callback(isOn) end
    end
    
    container.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            isOn = not isOn
            updateState()
        end
    end)
    updateState()
    
    return container
end

function SynthUI.TabFrame(props, parent)
    local container = SynthUI.Frame({Size = props.Size or UDim2.new(1, 0, 1, 0)}, parent)
    local tabs = SynthUI.Frame({Size = UDim2.new(1, 0, 0, 30), BackgroundColor3 = Color3.fromRGB(240, 240, 240)}, container)
    local content = SynthUI.Frame({Size = UDim2.new(1, 0, 1, -30), Position = UDim2.new(0, 0, 0, 30), BackgroundColor3 = Color3.fromRGB(255, 255, 255)}, container)
    content.ClipsDescendants = true -- ç¡®ä¿å†…å®¹ä¸æº¢å‡º
    
    local activeTab = 1
    local tabButtons = {}
    
    for i, tabName in ipairs(props.Tabs) do
        local tabBtn = SynthUI.Button({
            Text = tabName, 
            Size = UDim2.new(1 / #props.Tabs, 0, 1, 0), -- ä¿®æ­£ Size è®¡ç®—
            Position = UDim2.new((i-1) / #props.Tabs, 0, 0, 0), 
            Parent = tabs,
            BackgroundColor3 = Color3.fromRGB(200, 200, 200),
            BackgroundTransparency = (i == activeTab) and 0 or 0.5,
            TextColor3 = Color3.fromRGB(0, 0, 0)
        }, tabs)
        tabButtons[i] = tabBtn
        
        tabBtn.MouseButton1Click:Connect(function()
            activeTab = i
            
            -- æ›´æ–°æŒ‰é’®é€æ˜åº¦
            for j, btn in ipairs(tabButtons) do
                tween(btn, {BackgroundTransparency = (j == i) and 0 or 0.5}, 0.2)
            end
            
            -- æ›´æ–°å†…å®¹åŒº
            if props.TabsContent and props.TabsContent[i] then
                for _, child in ipairs(content:GetChildren()) do
                    if child:IsA("GuiBase2d") then
                        child.Visible = false
                    end
                end
                
                local currentContent = props.TabsContent[i]
                currentContent.Parent = content
                currentContent.Size = UDim2.new(1, 0, 1, 0) -- ç¡®ä¿å†…å®¹å æ»¡
                currentContent.Visible = true
            end
        end)
    end
    
    -- é¦–æ¬¡åŠ è½½æ˜¾ç¤ºç¬¬ä¸€ä¸ªæ ‡ç­¾å†…å®¹
    if props.TabsContent and props.TabsContent[1] then
        props.TabsContent[1].Parent = content
        props.TabsContent[1].Size = UDim2.new(1, 0, 1, 0)
    end
    
    return container
end

SynthUI.NotificationManager = {}
SynthUI.NotificationManager.__index = SynthUI.NotificationManager

local ICONS = {
    success = "rbxassetid://6034176210", -- æ›¿æ¢ä¸ºå®é™…çš„å›¾æ ‡IDæˆ–ä¿æŒå ä½ç¬¦
    error = "rbxassetid://6034176255",
    warning = "rbxassetid://6034176231",
    info = "rbxassetid://6034176243"
}

local COLORS = {
    success = {Color3.fromRGB(76, 175, 80), Color3.fromRGB(100, 200, 100)},
    error = {Color3.fromRGB(244, 67, 54), Color3.fromRGB(255, 100, 100)},
    warning = {Color3.fromRGB(255, 193, 7), Color3.fromRGB(255, 220, 100)},
    info = {Color3.fromRGB(33, 150, 243), Color3.fromRGB(100, 180, 255)}
}

function SynthUI.NotificationManager.new(parent)
    local self = setmetatable({}, SynthUI.NotificationManager)
    self.Parent = parent
    self.Notifications = {}
    self.NextY = 10
    return self
end

function SynthUI.NotificationManager:Show(type, title, message, duration)
    local notif = SynthUI.Frame({
        Size = UDim2.new(0, 300, 0, 80),
        Position = UDim2.new(1, -310, 0, self.NextY),
        BackgroundTransparency = 1,
        CornerRadius = 12
    }, self.Parent)
    notif.ZIndex = 5 -- ç¡®ä¿åœ¨é¡¶éƒ¨
    
    local gradient = Instance.new("UIGradient")
    gradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, COLORS[type][1]),
        ColorSequenceKeypoint.new(1, COLORS[type][2])
    }
    gradient.Rotation = 45
    gradient.Parent = notif
    
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(0, 0, 0)
    stroke.Thickness = 2
    stroke.Transparency = 0.5
    stroke.Parent = notif
    
    local icon = SynthUI.ImageLabel({Size = UDim2.new(0, 40, 0, 40), Position = UDim2.new(0, 15, 0.5, 0), Image = ICONS[type] or "", AnchorPoint = Vector2.new(0, 0.5), BackgroundTransparency = 1}, notif)
    
    local titleLabel = SynthUI.Label({Text = title, Position = UDim2.new(0, 65, 0, 10), Size = UDim2.new(1, -100, 0, 20), TextColor3 = Color3.fromRGB(255, 255, 255), TextSize = 16, Font = "GothamBold", BackgroundTransparency = 1, TextXAlignment = Enum.TextXAlignment.Left}, notif)
    local msgLabel = SynthUI.Label({Text = message, Position = UDim2.new(0, 65, 0, 35), Size = UDim2.new(1, -100, 0, 30), TextColor3 = Color3.fromRGB(255, 255, 255), TextSize = 14, BackgroundTransparency = 1, TextXAlignment = Enum.TextXAlignment.Left, TextWrapped = true}, notif)
    
    local closeBtn = SynthUI.Button({Text = "Ã—", Size = UDim2.new(0, 20, 0, 20), Position = UDim2.new(1, -25, 0, 10), TextSize = 18, BackgroundTransparency = 1, TextColor3 = Color3.fromRGB(255, 255, 255)}, notif)
    closeBtn.MouseButton1Click:Connect(function()
        self:Dismiss(notif)
    end)
    
    -- åŠ¨ç”»è¿›å…¥
    notif.Size = UDim2.new(0, 300, 0, 80)
    tween(notif, {Position = UDim2.new(1, -310, 0, self.NextY)}, 0.4, Enum.EasingStyle.Back)
    tween(notif, {BackgroundTransparency = 0}, 0.4)
    
    table.insert(self.Notifications, notif)
    self.NextY = self.NextY + 90
    
    spawn(function()
        wait(duration or 3)
        if notif and notif.Parent then -- é¿å…é‡å¤å…³é—­
            self:Dismiss(notif)
        end
    end)
    
    return notif
end

function SynthUI.NotificationManager:Dismiss(notif)
    for i, n in ipairs(self.Notifications) do
        if n == notif then
            table.remove(self.Notifications, i)
            spawn(function()
                -- åŠ¨ç”»é€€å‡º
                tween(notif, {Position = UDim2.new(1, 10, 0, notif.Position.Y.Offset), BackgroundTransparency = 1}, 0.3)
                wait(0.3)
                notif:Destroy()
            end)
            
            -- é‡æ’åˆ—å‰©ä½™é€šçŸ¥
            self.NextY = 10
            for _, remaining in ipairs(self.Notifications) do
                tween(remaining, {Position = UDim2.new(1, -310, 0, self.NextY)}, 0.2)
                self.NextY = self.NextY + 90
            end
            break
        end
    end
end

function SynthUI.Modal(props, parent)
    -- è¦†ç›–å±‚
    local overlay = SynthUI.Frame({Size = UDim2.new(1, 0, 1, 0), BackgroundColor3 = Color3.fromRGB(0, 0, 0), BackgroundTransparency = 1}, parent)
    overlay.ZIndex = 4
    
    -- å¯¹è¯æ¡†ä¸»ä½“
    local dialog = SynthUI.Frame({
        Size = props.Size or UDim2.new(0, 300, 0, 200), 
        Position = UDim2.new(0.5, -150, 0.5, -100), 
        BackgroundColor3 = Color3.fromRGB(255, 255, 255), -- ğŸ¯ ä¿®æ­£ï¼šUI èƒŒæ™¯ä¸ºç™½è‰²
        BackgroundTransparency = 0, -- ğŸ¯ ä¿®æ­£ï¼šUI èƒŒæ™¯ä¸é€æ˜
        CornerRadius = 8
    }, overlay)
    dialog.ZIndex = 5
    
    -- æ ‡é¢˜æ 
    local titleBar = SynthUI.Frame({Size = UDim2.new(1, 0, 0, 30), BackgroundColor3 = Color3.fromRGB(240, 240, 240)}, dialog)
    titleBar.ClipsDescendants = true
    
    -- æ ‡é¢˜
    local title = SynthUI.Label({
        Text = props.Title or "Modal", 
        Size = props.Subtitle and UDim2.new(0.6, 0, 0.5, 0) or UDim2.new(0.6, 0, 1, 0),
        Position = props.Subtitle and UDim2.new(0, 10, 0, 0) or UDim2.new(0, 10, 0, 0),
        BackgroundTransparency = 1, 
        TextSize = 14, 
        TextColor3 = Color3.fromRGB(0, 0, 0),
        TextScaled = false, -- ğŸ¯ ä¿®æ­£ï¼šä¸ä½¿ç”¨ TextScaled
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = props.Subtitle and Enum.TextYAlignment.Top or Enum.TextYAlignment.Center -- æ–‡æœ¬å±…ä¸­
    }, titleBar)
    
    -- å‰¯æ ‡é¢˜
    if props.Subtitle then
        SynthUI.Label({
            Text = props.Subtitle, 
            Size = UDim2.new(0.6, 0, 0.5, 0), 
            Position = UDim2.new(0, 10, 0.5, 0), 
            BackgroundTransparency = 1, 
            TextSize = 10, 
            TextColor3 = Color3.fromRGB(100, 100, 100), 
            TextScaled = false,
            TextXAlignment = Enum.TextXAlignment.Left
        }, titleBar)
    end
    
    SynthUI.MakeDraggable(dialog, titleBar)
    
    -- æœ€å°åŒ–æŒ‰é’®
    local minBtn = SynthUI.Button({
        Text = "â–½", -- ğŸ¯ ä¿®æ­£ï¼šæœ€å°åŒ–å›¾æ ‡ (â–½)
        Size = UDim2.new(0, 30, 1, 0), 
        Position = UDim2.new(1, -90, 0, 0), 
        TextSize = 16, 
        BackgroundColor3 = Color3.fromRGB(200, 200, 200), 
        TextColor3 = Color3.fromRGB(0, 0, 0),
        Parent = titleBar
    }, titleBar)
    
    -- æœ€å¤§åŒ–æŒ‰é’®
    local maxBtn = SynthUI.Button({
        Text = "â–¡", -- æœ€å¤§åŒ–å›¾æ ‡ (â–¡)
        Size = UDim2.new(0, 30, 1, 0), 
        Position = UDim2.new(1, -60, 0, 0), 
        TextSize = 16, 
        BackgroundColor3 = Color3.fromRGB(200, 200, 200), 
        TextColor3 = Color3.fromRGB(0, 0, 0),
        Parent = titleBar
    }, titleBar)
    
    -- å…³é—­æŒ‰é’®
    local closeBtn = SynthUI.Button({
        Text = "Ã—", 
        Size = UDim2.new(0, 30, 1, 0), 
        Position = UDim2.new(1, -30, 0, 0), 
        TextSize = 16, 
        BackgroundColor3 = Color3.fromRGB(255, 100, 100), 
        TextColor3 = Color3.fromRGB(255, 255, 255), 
        Parent = titleBar
    }, titleBar)
    
    -- å†…å®¹åŒº
    local content = SynthUI.Frame({
        Size = UDim2.new(1, 0, 1, -30), 
        Position = UDim2.new(0, 0, 0, 30), 
        BackgroundColor3 = Color3.fromRGB(255, 255, 255), 
        BackgroundTransparency = 0,
        Parent = dialog
    }, dialog)
    
    local isMaximized = false
    local isMinimized = false -- ğŸ¯ ä¿®æ­£ï¼šæœ€å°åŒ–çŠ¶æ€
    local originalSize = props.Size or UDim2.new(0, 300, 0, 200)
    local originalPos = dialog.Position -- åˆå§‹ä½ç½®
    local currentOriginalSize = originalSize
    
    -- å…³é—­é€»è¾‘
    closeBtn.MouseButton1Click:Connect(function()
        tween(overlay, {BackgroundTransparency = 1}, 0.2)
        tween(dialog, {Size = UDim2.new(0, 0, 0, 0)}, 0.2)
        spawn(function()
            wait(0.2)
            overlay:Destroy()
            if props.OnClose then props.OnClose() end
        end)
    end)
    
    -- æœ€å°åŒ–é€»è¾‘
    minBtn.MouseButton1Click:Connect(function()
        isMinimized = not isMinimized
        content.Visible = not isMinimized
        
        if isMinimized then
            -- æœ€å°åŒ–ï¼šåªæ˜¾ç¤ºæ ‡é¢˜æ 
            currentOriginalSize = dialog.Size 
            minBtn.Text = "â–³" -- æ¢å¤å›¾æ ‡ (â–³)
            -- ä¿æŒ X è½´å°ºå¯¸ï¼ŒY è½´ç¼©å°åˆ°æ ‡é¢˜æ é«˜åº¦
            tween(dialog, {Size = UDim2.new(dialog.Size.X.Scale, dialog.Size.X.Offset, 0, 30)}, 0.2) 
        else
            -- æ¢å¤
            minBtn.Text = "â–½" -- æœ€å°åŒ–å›¾æ ‡ (â–½)
            tween(dialog, {Size = currentOriginalSize}, 0.2)
        end
    end)
    
    -- æœ€å¤§åŒ–é€»è¾‘
    maxBtn.MouseButton1Click:Connect(function()
        isMaximized = not isMaximized
        
        if isMaximized then
            -- è®°å½•å½“å‰ä½ç½®å’Œå°ºå¯¸
            currentOriginalSize = dialog.Size
            originalPos = dialog.Position
            
            -- æœ€å¤§åŒ–
            tween(dialog, {Size = UDim2.new(1, 0, 1, 0), Position = UDim2.new(0, 0, 0, 0)}, 0.2)
            maxBtn.Text = "â" -- æ¢å¤å›¾æ ‡
        else
            -- æ¢å¤
            tween(dialog, {Size = currentOriginalSize, Position = originalPos}, 0.2)
            maxBtn.Text = "â–¡" -- æœ€å¤§åŒ–å›¾æ ‡
        end
        
        -- æœ€å¤§åŒ–/æ¢å¤æ—¶ï¼Œå¦‚æœå¤„äºæœ€å°åŒ–çŠ¶æ€ï¼Œå¼ºåˆ¶æ¢å¤å†…å®¹å¯è§
        if isMinimized then
             isMinimized = false
             content.Visible = true
             minBtn.Text = "â–½"
        end
    end)
    
    -- åˆå§‹åŠ¨ç”»
    overlay.BackgroundTransparency = 1
    dialog.Size = UDim2.new(0, 0, 0, 0)
    tween(overlay, {BackgroundTransparency = 0.5}, 0.3) -- è¦†ç›–å±‚æ¸å˜æ˜¾ç¤º
    tween(dialog, {Size = originalSize, Position = originalPos}, 0.3)
    
    if props.Content then
        props.Content.Parent = content
        props.Content.Size = UDim2.new(1, 0, 1, 0)
    end
    
    return overlay
end

function SynthUI.GridLayout(props, parent)
    local grid = Instance.new("UIGridLayout")
    grid.Parent = parent
    grid.CellSize = props.CellSize or UDim2.new(0, 100, 0, 100)
    grid.CellPadding = props.CellPadding or UDim2.new(0, 5, 0, 5)
    return grid
end

function SynthUI.ListLayout(props, parent)
    local list = Instance.new("UIListLayout")
    list.Parent = parent
    list.FillDirection = props.FillDirection or Enum.FillDirection.Vertical
    list.Padding = UDim.new(0, props.Padding or 5)
    list.HorizontalAlignment = props.HorizontalAlignment or Enum.HorizontalAlignment.Left
    list.VerticalAlignment = props.VerticalAlignment or Enum.VerticalAlignment.Top
    return list
end

return SynthUI
